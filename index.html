<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg ‚Äì Keres≈ë</title>
  <style>
    
      body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-image: url("hatter.jpg");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}
    
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { opacity: .75; font-size: 12px; margin-top: 8px; }
    .sec { font-weight: bold; margin: 10px 0 6px; }
    ul { margin: 6px 0 10px 20px; }
    code { background:#f3f3f3; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>üìö Kis Herceg k√∂nyvesbolt - rendel√©s keres≈ë</h2>
  <p>√çrd be a neved, √©s megn√©zz√ºk az <b>aj√°nl√°s</b> √©s a <b>rendel√©s</b> list√°kat.</p>

  <input id="name" placeholder="Pl. K√°d√°r Krisztina" />
  <button id="btn" type="button">Keres√©s</button>

  <div id="ver" class="muted"></div>
  <div id="result" class="box">üîé Keres√©shez √≠rd be a neved.</div>

<script>
(() => {
  const VERSION = "VERZI√ì: 2025-12-14 (2 f√°jl: ajanlas.txt + rendelesek.txt)";
  const $ = (id) => document.getElementById(id);

  // √©kezet- √©s id√©z≈ëjel-toler√°ns keres√©s
  function norm(s) {
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")   // √©kezet le
      .replace(/[‚Äú‚Äù‚Äû"]/g, "")           // id√©z≈ëk le
      .replace(/\s+/g, " ");            // sok space -> 1
  }
  function tokens(q) {
    return norm(q).split(" ").filter(Boolean);
  }
  function containsAll(hay, tok) {
    const h = norm(hay);
    return tok.every(t => h.includes(t));
  }

  // ---------- AJ√ÅNL√ÅS: c√≠m + sorsz√°mos nevek ----------
  function isATitle(line) {
    // pl: "A VAR√ÅZSLATOS T√âRK√âP - 86 lej"
    const s = (line || "").trim();
    if (!s) return false;
    if (/^\d+\./.test(s)) return false;
    if (/^[‚Ä¢\*\-]/.test(s)) return false;
    return /lej/i.test(s) && /[-‚Äì‚Äî]/.test(s);
  }
  function parseANumberedName(line) {
    const m = (line || "").trim().match(/^\d+\.\s*(.+)$/);
    return m ? m[1].trim() : null;
  }

  // ---------- RENDEL√âSEK: N√âV: + ‚Ä¢ t√©telek ----------
  function parseBHeader(line) {
    // N√âV: Valaki (id√©z≈ëjellel is)
    const m = (line || "").trim().match(/^"??\s*N√âV\s*:\s*(.+?)\s*"?$/i);
    return m ? m[1].trim() : null;
  }
  function isBullet(line) {
    return /^[‚Ä¢\\-]\s/.test((line || "").trim());
  }
  function cleanBullet(line) {
    return (line || "").trim().replace(/^[‚Ä¢\\-]\s/, "").trim();
  }

  async function loadTxt(file) {
    // cache-biztos: mindig friss URL
    const url = file + "?v=" + Date.now();
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(file + " HTTP " + res.status);
    return await res.text();
  }

  function parseAjanlas(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);
    const foundTitles = new Set();
    let currentTitle = "";

    for (const line of lines) {
      if (isATitle(line)) { currentTitle = line; continue; }
      const nm = parseANumberedName(line);
      if (nm && currentTitle && containsAll(nm, tok)) foundTitles.add(currentTitle);
    }
    return [...foundTitles];
  }

  function parseRendelesek(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);

    const matches = []; // { name, items[] }
    let curName = null;
    let curItems = [];

    function flush() {
      if (!curName) return;
      if (containsAll(curName, tok)) {
        // dupl√°k ellen
        const uniq = [];
        for (const it of curItems) if (!uniq.includes(it)) uniq.push(it);
        matches.push({ name: curName, items: uniq });
      }
    }

    for (const line of lines) {
      const header = parseBHeader(line);
      if (header) {
        flush();
        curName = header;
        curItems = [];
        continue;
      }
      if (curName && isBullet(line)) {
        curItems.push(cleanBullet(line));
      }
    }
    flush();
    return matches;
  }

  async function search() {
    const qRaw = $("name").value || "";
    const tok = tokens(qRaw);
    const out = $("result");

    out.innerHTML = "‚è≥ Keres√©s‚Ä¶";

    if (!tok.length) {
      out.innerHTML = "üîé √çrj be egy nevet üôÇ";
      return;
    }

    let ajanlasTxt = "";
    let rendelesTxt = "";

    try {
      // p√°rhuzamos bet√∂lt√©s
      [ajanlasTxt, rendelesTxt] = await Promise.all([
        loadTxt("ajanlas.txt"),
        loadTxt("rendelesek.txt")
      ]);
    } catch (e) {
      out.innerHTML = "‚ùå Hiba a f√°jl bet√∂lt√©sn√©l: <code>" + (e && e.message ? e.message : e) + "</code><br>" +
                      "Ellen≈ërizd, hogy a repo gy√∂ker√©ben van: <b>ajanlas.txt</b> √©s <b>rendelesek.txt</b>.";
      return;
    }

    const foundA = parseAjanlas(ajanlasTxt, tok);
    const foundB = parseRendelesek(rendelesTxt, tok);

    if (!foundA.length && !foundB.length) {
      out.innerHTML = "‚ùå Nincs tal√°lat erre: <b>" + qRaw + "</b>";
      return;
    }

    let html = "‚úÖ <b>Tal√°lat:</b> <b>" + qRaw + "</b><br><br>";

    if (foundA.length) {
      html += '<div class="sec">üìö Aj√°nl√°s (c√≠mek, ahol szerepelsz):</div><ul>';
      foundA.forEach(t => html += "<li>" + t + "</li>");
      html += "</ul>";
    }

    if (foundB.length) {
      html += '<div class="sec">üßæ Rendel√©sek (N√âV: blokk):</div>';
      foundB.forEach(b => {
        html += "<b>" + b.name + "</b>";
        if (b.items.length) {
          html += "<ul>";
          b.items.forEach(it => html += "<li>" + it + "</li>");
          html += "</ul>";
        } else {
          html += '<div class="muted">Nincs ‚Ä¢ t√©tel sor ehhez a n√©vhez.</div>';
        }
      });
    }

    out.innerHTML = html;
  }

  document.addEventListener("DOMContentLoaded", () => {
    $("ver").innerText = VERSION;
    $("btn").addEventListener("click", search);
    $("name").addEventListener("keydown", (e) => { if (e.key === "Enter") search(); });
  });
})();
</script>
</body>
</html>
