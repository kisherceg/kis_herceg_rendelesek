<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg ‚Äì Rendel√©s keres≈ë</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 8px 0 10px; }
    h3 { margin: 12px 0 6px; }
    ul { margin: 6px 0 0 18px; }
    li { margin: 3px 0; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-left:6px; color:#555;}
    .ok { color: #0a7; }
    .bad { color: #c33; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>üìö Kis Herceg ‚Äì N√©v szerinti keres≈ë</h2>
  <p class="muted">√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

  <input id="name" placeholder="Pl. B√≠r√≥ R√©ka" />
  <button id="btn" type="button">Keres√©s</button>

  <div class="box" id="result">üîé Keres√©shez √≠rd be a neved.</div>

<script>
/* --- Seg√©dek --- */
function esc(s) {
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}
function norm(s) {
  return String(s)
    .toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '')   // √©kezetek le
    .replace(/[‚Äú‚Äù‚Äû"]/g, '')                            // id√©z≈ëk le
    .replace(/\s+/g, ' ')                              // sok space -> 1
    .trim();
}
function looksLikeRecommendationTitle(line) {
  // pl: "A VAR√ÅZSLATOS T√âRK√âP - 86 lej" (van "lej" √©s van k√∂t≈ëjel/gondolatjel)
  const s = line.trim();
  return /lej/i.test(s) && /[-‚Äì‚Äî]/.test(s);
}
function parseNumberedName(line) {
  // "1. Kov√°cs Anabella" -> "Kov√°cs Anabella"
  const m = line.trim().match(/^\s*\d+\.\s*(.+)$/);
  return m ? m[1].trim() : null;
}
function parseNevLine(line) {
  // '"N√âV: K√°d√°r Krisztina"' vagy 'N√âV: K√°d√°r Krisztina'
  const m = line.trim().match(/^\s*"?\s*N√âV\s*:\s*(.+?)\s*"?\s*$/i);
  return m ? m[1].trim() : null;
}
function isItemLine(line) {
  // bullet sorok: ‚Ä¢ ...  vagy - ...  vagy * ...
  const s = line.trim();
  return /^([‚Ä¢\-\*])\s+/.test(s);
}
function cleanItemLine(line) {
  return line.trim().replace(/^([‚Ä¢\-\*])\s+/, '‚Ä¢ ');
}

/* --- F≈ë keres√©s --- */
async function search() {
  const qRaw = document.getElementById("name").value;
  const q = norm(qRaw);
  const result = document.getElementById("result");

  if (!q) { result.innerHTML = 'üôÇ √çrj be egy nevet.'; return; }

  let text = "";
  try {
    // cache-bypass GitHub Pages-hez
    const res = await fetch("rendeles.txt?v=" + Date.now(), { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    text = await res.text();
  } catch (e) {
    result.innerHTML = '‚ùå Nem tudtam bet√∂lteni a <code>rendeles.txt</code> f√°jlt.';
    return;
  }

  const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(l => l.length > 0);

  /* 1) AJ√ÅNL√ìS LISTA (c√≠m + sorsz√°mozott nevek) */
  // name -> Set(titles)
  const recoByName = new Map();
  let currentTitle = "";

  for (const line of lines) {
    if (looksLikeRecommendationTitle(line)) {
      currentTitle = line;
      continue;
    }
    const nm = parseNumberedName(line);
    if (nm && currentTitle) {
      const key = norm(nm);
      if (!recoByName.has(key)) recoByName.set(key, new Set());
      recoByName.get(key).add(currentTitle);
    }
  }

  /* 2) RENDEL√âSI LISTA (N√âV: ... + bullet t√©telek) */
  // name -> items[]
  const orderByName = new Map();
  let currentName = null;

  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];

    const maybeName = parseNevLine(line);
    if (maybeName) {
      currentName = maybeName;
      const key = norm(currentName);
      if (!orderByName.has(key)) orderByName.set(key, []);
      continue;
    }

    if (currentName && isItemLine(line)) {
      const key = norm(currentName);
      orderByName.get(key).push(cleanItemLine(line));
    }
  }

  /* TAL√ÅLATOK */
  // r√©szleges keres√©s: ha a be√≠rt sz√∂veg benne van a n√©vben
  const recoHits = [];
  for (const [nameKey, titles] of recoByName.entries()) {
    if (nameKey.includes(q)) recoHits.push({ nameKey, titles: [...titles] });
  }

  const orderHits = [];
  for (const [nameKey, items] of orderByName.entries()) {
    if (nameKey.includes(q)) orderHits.push({ nameKey, items });
  }

  if (recoHits.length === 0 && orderHits.length === 0) {
    result.innerHTML = ‚ùå Nem tal√°ltunk tal√°latot ezzel a n√©vvel: <b>${esc(qRaw)}</b>;
    return;
  }

  let html = ‚úÖ Tal√°lat: <b>${esc(qRaw)}</b><br><br>;

  if (recoHits.length) {
    html += <b>üìå Aj√°nl√≥s list√°k:</b><br>;
    // c√≠mek egyben (duplik√°ci√≥ n√©lk√ºl)
    const titleSet = new Set();
    recoHits.forEach(h => h.titles.forEach(t => titleSet.add(t)));
    [...titleSet].forEach(t => { html += ‚Ä¢ ${esc(t)}<br>; });
    html += <br>;
  }

  if (orderHits.length) {
    html += <b>üßæ Rendel√©si t√©telek:</b><br>;
    // ha t√∂bb n√©v is egyezik (pl. csak vezet√©kn√©v), k√ºl√∂n blokkok
    orderHits.forEach(h => {
      html += <div class="box"><b>${esc(h.nameKey)}</b> <span class="pill">N√âV blokk</span><br>;
      if (h.items.length) {
        html += <ul>;
        h.items.forEach(it => { html += <li>${esc(it)}</li>; });
        html += </ul>;
      } else {
        html += <span class="muted">Nincs t√©tel sor (‚Ä¢) ehhez a n√©vhez.</span>;
      }
      html += </div>;
    });
  }

  result.innerHTML = html;
}
 document.getElementById("result").innerHTML = "‚úÖ JS bet√∂ltve, mehet a keres√©s.";
document.getElementById("btn").addEventListener("click", search);
document.getElementById("name").addEventListener("keydown", (e) => {
  if (e.key === "Enter") search();
});  
</script>
</body>
</html>
