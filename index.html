<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg â€“ RendelÃ©s keresÅ‘</title>
  <style>
    body { font-family: Arial; max-width: 640px; margin: auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 0 0 6px 0; }
    ul { margin: 6px 0 0 18px; }
    hr { border: none; border-top: 1px solid #eee; margin: 12px 0; }
  </style>
</head>

<body>
  <h2>ğŸ“š Kis Herceg â€“ NÃ©v szerinti keresÅ‘</h2>
  <p class="muted">Ãrd be a neved, Ã©s kilistÃ¡zzuk a tÃ©teleidet.</p>

  <input id="name" placeholder="Pl. KÃ¡dÃ¡r Krisztina" />
  <button onclick="alert('KATT!')">KeresÃ©s</button>

  <div class="box" id="result">ğŸ” KeresÃ©shez Ã­rd be a neved.</div>

  <script>
    function norm(s) {
      return (s || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "") // Ã©kezetek le
        .replace(/\s+/g, " ")
        .trim();
    }

    function cleanLine(s) {
      return (s || "").replace(/^["â€œâ€]+|["â€œâ€]+$/g, "").trim();
    }

    async function search() {
      const qRaw = document.getElementById("name").value.trim();
      const q = norm(qRaw);
      const result = document.getElementById("result");

      if (!q) {
        result.innerHTML = "Ãrj be egy nevet ğŸ™‚";
        return;
      }

      let text = "";
      try {
        const res = await fetch("rendeles.txt?v=" + Date.now(), { cache: "no-store" });
        text = await res.text();
      } catch (e) {
        result.innerHTML = "Nem tudtam betÃ¶lteni a rendeles.txt fÃ¡jlt ğŸ˜•";
        return;
      }

      const lines = text
        .split(/\r?\n/)
        .map(l => cleanLine(l))
        .filter(l => l.length > 0);

      // ===== 1) AJÃNLÃ“S LISTA (cÃ­m + szÃ¡mozott nevek) =====
      const foundTitles = new Set();
      let currentTitle = "";

      const looksLikeTitle = (s) => /[-â€“â€”]/.test(s) && /\blej\b/i.test(s); // van kÃ¶tÅ‘jel + "lej"
      const isNumberedName = (s) => /^\d+\.\s+/.test(s);

      for (const line of lines) {
        if (looksLikeTitle(line)) {
          currentTitle = line;
          continue;
        }
        if (currentTitle && isNumberedName(line)) {
          const namePart = line.replace(/^\d+\.\s+/, "").trim();
          if (norm(namePart).includes(q)) {
            foundTitles.add(currentTitle);
          }
        }
      }

      // ===== 2) NÃ‰V: BLOKK (NÃ‰V: XY + â€¢ tÃ©telek) =====
      const foundItems = [];
      let currentName = "";
      let collecting = false;

      const isNameHeader = (s) => /^NÃ‰V\s*:\s*/i.test(s);
      const extractName = (s) => s.replace(/^NÃ‰V\s*:\s*/i, "").trim();

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        if (isNameHeader(line)) {
          currentName = extractName(line);
          collecting = norm(currentName).includes(q);
          continue;
        }

        // ha Ã©pp az adott nÃ©v blokkja jÃ¶n:
        if (collecting) {
          // tÃ©telsor: â€¢ valami â€“ Ã¡r lej (vagy bÃ¡rmi â€¢-vel)
          if (/^[â€¢\-\u2022]\s*/.test(line)) {
            foundItems.push(line.replace(/^[â€¢\-\u2022]\s*/, "â€¢ ").trim());
          } else {
            // ha nem tÃ©tel Ã©s jÃ¶n egy Ãºj NÃ‰V: majd kezeljÃ¼k feljebb
            // egyÃ©b sort egyszerÅ±en ignorÃ¡ljuk
          }
        }
      }

      // ===== KIÃRÃS =====
      if (foundTitles.size === 0 && foundItems.length === 0) {
        result.innerHTML = âŒ Nem talÃ¡ltunk talÃ¡latot ezzel a nÃ©vvel: <b>${qRaw}</b>;
        return;
      }

      let html = âœ… TalÃ¡lat: <b>${qRaw}</b><br><br>;

      if (foundTitles.size) {
        html += <b>ğŸ“Œ AjÃ¡nlÃ³s listÃ¡k:</b><br>;
        [...foundTitles].forEach(t => html += â€¢ ${t}<br>);
        html += <hr>;
      }

      if (foundItems.length) {
        html += <b>ğŸ§¾ Bookline / tÃ¡blÃ¡zatos rendelÃ©sek:</b><br>;
        html += <ul>;
        foundItems.forEach(it => html += <li>${it.replace(/^â€¢\s*/, "")}</li>);
        html += </ul>;
      }

      result.innerHTML = html;  // â¬…ï¸ FIGYELD: PONT, nem kettÅ‘spont!
    }

    document.getElementById("btn").addEventListener("click", search);
    document.getElementById("name").addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  </script>
</body>
</html>
