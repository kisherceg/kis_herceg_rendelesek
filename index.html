<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg - Rendel√©s </title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 680px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 0 0 8px 0; }
    h3 { margin: 14px 0 6px 0; }
    ul { margin: 6px 0 0 18px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-left:8px; color:#444; }
    .err { color: #b00020; }
  </style>
</head>

<body>
  <h2>üìö Kis Herceg ‚Äì N√©v keres≈ë</h2>
  <p class="muted">√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

  <input id="name" placeholder="Pl. K√°d√°r Krisztina">
  <button id="btn">Keres√©s</button>
  <div id="result">üîé Keres√©shez √≠rd be a neved.</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("name");
  const btn = document.getElementById("btn");
  const result = document.getElementById("result");

  function norm(s) {
    return (s || "")
      .toLowerCase()
      .replace(/[\u0300-\u036f]/g, "") // biztos ami biztos (√©kezet jelek)
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/["']/g, "")
      .replace(/\s+/g, " ")
      .trim();
  }

  async function search() {
    try {
      const qRaw = input.value.trim();
      const q = norm(qRaw);

      if (!q) {
        result.innerHTML = "üîé √çrd be a neved.";
        return;
      }

      // 1) TXT bet√∂lt√©s (ha ez nem megy, itt ki√≠rjuk a hib√°t)
      const res = await fetch("./rendeles.txt", { cache: "no-store" });
      if (!res.ok) throw new Error("Nem tudtam bet√∂lteni: rendeles.txt (HTTP " + res.status + ")");

      const text = await res.text();
      const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);

      // 2) K√©t form√°tum feldolgoz√°sa
      const listHits = [];   // [c√≠mek]
      const blockHits = [];  // [{name, items[]}]

      // A) C√çM + sorsz√°mozott nevek
      let currentTitle = "";
      for (const line of lines) {
        // c√≠m: tartalmaz "lej" √©s van benne gondolatjel / k√∂t≈ëjel, de nem "N√âV:" √©s nem ‚Ä¢ √©s nem "1."
        const isTitle =
          /lej/i.test(line) &&
          /[-‚Äì‚Äî]/.test(line) &&
          !/^"N√âV:/i.test(line) &&
          !/^‚Ä¢/.test(line) &&
          !/^\d+\./.test(line);

        if (isTitle) {
          currentTitle = line;
          continue;
        }

        // n√©vsor: "1. Kov√°cs Anabella"
        if (/^\d+\./.test(line)) {
          const namePart = line.replace(/^\d+\.\s*/, "");
          if (norm(namePart).includes(q) && currentTitle) {
            listHits.push(currentTitle);
          }
        }
      }

      // B) "N√âV: ..." + ‚Ä¢ t√©telek
      let i = 0;
      while (i < lines.length) {
        const line = lines[i];

        if (/^"N√âV:/i.test(line)) {
          const fullName = line
            .replace(/^"N√âV:\s*/i, "")
            .replace(/"$/, "")
            .trim();

          const fullNameNorm = norm(fullName);

          // gy≈±jtj√ºk a k√∂vetkez≈ë ‚Ä¢ sorokat, am√≠g √∫j "N√âV:" nem j√∂n
          const items = [];
          i++;
          while (i < lines.length && !/^"N√âV:/i.test(lines[i])) {
            const l2 = lines[i];
            if (/^‚Ä¢/.test(l2)) items.push(l2.replace(/^‚Ä¢\s*/, ""));
            i++;
          }

          if (fullNameNorm.includes(q)) {
            blockHits.push({ name: fullName, items });
          }
          continue;
        }

        i++;
      }

      // 3) Ki√≠r√°s
      if (!listHits.length && !blockHits.length) {
        result.innerHTML = "‚ùå Nincs tal√°lat erre a n√©vre.";
        return;
      }

      let html = ‚úÖ <b>Tal√°lat:</b> <b>${qRaw}</b><br><br>;

      if (listHits.length) {
        const uniq = [...new Set(listHits)];
        html += "<b>üìö List√°k:</b><br>";
        uniq.forEach(t => { html += "‚Ä¢ " + t + "<br>"; });
        html += "<br>";
      }

      if (blockHits.length) {
        html += "<b>üßæ Rendel√©sek:</b><br>";
        blockHits.forEach(b => {
          html += <b>${b.name}</b><br>;
          if (b.items.length) {
            b.items.forEach(it => { html += "‚Ä¢ " + it + "<br>"; });
          } else {
            html += "<i>‚Ä¢ (nincs t√©tel)</i><br>";
          }
          html += "<br>";
        });
      }

      result.innerHTML = html;

    } catch (e) {
      result.innerHTML = "‚ùå Hiba: " + (e && e.message ? e.message : String(e));
    }
  }

  btn.addEventListener("click", search);
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") search();
  });
});
</script>

  
</body>
</html>
