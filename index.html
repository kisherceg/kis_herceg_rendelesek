<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg - Rendel√©s keres≈ë</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 680px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 0 0 8px 0; }
    h3 { margin: 14px 0 6px 0; }
    ul { margin: 6px 0 0 18px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-left:8px; color:#444; }
    .err { color: #b00020; }
  </style>
</head>

<body>
  <h2>üìö Kis Herceg ‚Äì N√©v szerinti keres≈ë</h2>
  <p class="muted">√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

  <input id="name" placeholder="Pl. K√°d√°r Krisztina">
  <button id="btn">Keres√©s</button>
  <div class="box" id="result">üîé Keres√©shez √≠rd be a neved.</div>

<script>
  const norm = (s) =>
    (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/\s+/g, " ");

  const isAllCapsTitle = (s) => {
    // pl: "A VAR√ÅZSLATOS T√âRK√âP - 86 lej"
    if (!s) return false;
    if (!/lej/i.test(s)) return false;
    if (!/[-‚Äì‚Äî]/.test(s)) return false;
    const letters = s.replace(/[^A-Za-z√Å√â√ç√ì√ñ≈ê√ö√ú≈∞√°√©√≠√≥√∂≈ë√∫√º≈±]/g, "");
    if (letters.length < 6) return false;
    return s === s.toUpperCase();
  };

  const isNameHeader = (s) => {
    // "N√âV: K√°d√°r Krisztina" (id√©z≈ëjellel is)
    return /^"?\s*N√âV\s*:\s*/i.test(s || "");
  };

  const extractNameFromHeader = (s) => {
    // leveszi a N√âV: r√©szt + id√©z≈ëjeleket
    return (s || "")
      .replace(/^"?\s*N√âV\s*:\s*/i, "")
      .replace(/"$/g, "")
      .trim();
  };

  const isBooklineTitleLine = (s) => {
    // pl: "Bak√≥ J√°nosi Annam√°ria ‚Äì Bookline rendel√©s DECEMBER 1."
    return /bookline\s+rendel[e√©]s/i.test(s || "");
  };

  const extractNameFromBooklineTitle = (s) => {
    // n√©v a gondolatjel el≈ëtt
    const parts = (s || "").split(/[-‚Äì‚Äî]/);
    return (parts[0] || "").replace(/"/g, "").trim();
  };

  const looksLikeItemLine = (s) => {
    // t√©telsor a n√©vblokkban: bullet vagy "lej" szerepel
    if (!s) return false;
    if (/^‚Ä¢/.test(s)) return true;
    if (/lej/i.test(s) && !isAllCapsTitle(s) && !isNameHeader(s) && !isBooklineTitleLine(s)) return true;
    return false;
  };

  async function search() {
    const qRaw = document.getElementById("name").value.trim();
    const q = norm(qRaw);
    const result = document.getElementById("result");

    if (!q) {
      result.innerHTML = "üîé Keres√©shez √≠rd be a neved.";
      return;
    }

    // cache-busting, hogy mindig a friss rendeles.txt-t hozza
    const res = await fetch("rendeles.txt?v=" + Date.now(), { cache: "no-store" });
    const text = await res.text();

    const lines = text
      .split(/\r?\n/)
      .map((l) => (l || "").trim())
      .filter((l) => l.length > 0);

    // -------- 1) AJ√ÅNL√ì LIST√ÅK (C√çM -> N√âV sorok)
    let currentTitle = "";
    const foundTitles = new Set();

    // -------- 2) BOOKLINE N√âV BLOKKOK (N√âV -> t√©telek)
    let currentName = null;
    const itemsByName = new Map(); // normName -> {displayName, items[]}

    const pushItem = (nameDisplay, itemLine) => {
      const key = norm(nameDisplay);
      if (!itemsByName.has(key)) itemsByName.set(key, { displayName: nameDisplay, items: [] });

      // kicsit tiszt√≠tjuk a t√©telsort (bullet/id√©z≈ëjel)
      let it = itemLine.replace(/^‚Ä¢\s*/g, "").replace(/^"+|"+$/g, "").trim();
      if (!it) return;

      // duplik√°tum ellen
      const obj = itemsByName.get(key);
      if (!obj.items.includes(it)) obj.items.push(it);
    };

    for (let i = 0; i < lines.length; i++) {
      const line = lines[i];

      // --- Aj√°nl√≥ lista c√≠m (ALL CAPS + lej + gondolatjel)
      if (isAllCapsTitle(line)) {
        currentTitle = line;
        continue;
      }

      // --- Aj√°nl√≥ lista n√©vsor (pl. "1. Kov√°cs Anabella")
      if (currentTitle && /^\d+\.\s+/.test(line)) {
        const namePart = line.replace(/^\d+\.\s+/, "").trim();
        if (norm(namePart).includes(q)) foundTitles.add(currentTitle);
        continue;
      }

      // --- Bookline blokk c√≠m (n√©v ‚Äì Bookline rendel√©s ...)
      if (isBooklineTitleLine(line)) {
        currentName = extractNameFromBooklineTitle(line);
        continue;
      }

      // --- "N√âV: ..." blokk
      if (isNameHeader(line)) {
        currentName = extractNameFromHeader(line);
        continue;
      }

      // --- T√©telek gy≈±jt√©se aktu√°lis n√©vhez
      if (currentName && looksLikeItemLine(line)) {
        pushItem(currentName, line);
        continue;
      }
    }

    // ------- EREDM√âNY KI√çR√ÅS
    const htmlParts = [];
    htmlParts.push(<div><b>‚úÖ Tal√°latok:</b> <b>${qRaw}</b></div><br>);

    // 1) List√°k
    if (foundTitles.size > 0) {
      htmlParts.push(<div><b>üìö List√°k:</b></div><ul>);
      [...foundTitles].forEach((t) => htmlParts.push(<li>${t}</li>));
      htmlParts.push(</ul>);
    }

    // 2) N√©v blokkok t√©telei
    // (tal√°lat: ha a keresett n√©v benne van a blokk nev√©ben)
    const matchedBlocks = [];
    for (const [k, obj] of itemsByName.entries()) {
      if (k.includes(q)) matchedBlocks.push(obj);
    }

    if (matchedBlocks.length > 0) {
      matchedBlocks.forEach((obj) => {
        htmlParts.push(<div style="margin-top:10px;"><b>üßæ Rendel√©seid ‚Äì ${obj.displayName}:</b></div>);
        if (obj.items.length) {
          htmlParts.push(<ul>);
          obj.items.forEach((it) => htmlParts.push(<li>${it}</li>));
          htmlParts.push(</ul>);
        } else {
          htmlParts.push(<div style="opacity:.7;">(Nincs t√©tel sor)</div>);
        }
      });
    }

    if (foundTitles.size === 0 && matchedBlocks.length === 0) {
      htmlParts.push(<div>‚ùå Nem tal√°ltam tal√°latot ezzel a n√©vvel.</div>);
    }

    result.innerHTML = htmlParts.join("");
  }

  // gomb + Enter
  document.getElementById("btn").addEventListener("click", search);
  document.getElementById("name").addEventListener("keydown", (e) => {
    if (e.key === "Enter") search();
  });
</script>

  
</body>
</html>
