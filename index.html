<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg - Rendel√©s keres≈ë</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 680px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 0 0 8px 0; }
    h3 { margin: 14px 0 6px 0; }
    ul { margin: 6px 0 0 18px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radi‚Ä¶
[12:21, 2025. 12. 14.] Szasz Reka: <!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg ‚Äì Rendel√©s keres≈ë</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 640px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { opacity: .75; }
    .secTitle { margin: 10px 0 6px; font-weight: bold; }
    ul { margin: 6px 0 10px 20px; }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>üìö Kis Herceg ‚Äì N√©v szerinti keres≈ë</h2>
  <p>√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

  <input id="name" placeholder="Pl. K√°d√°r Krisztina" />
  <button id="btn" type="button">Keres√©s</button>

  <div id="ver" class="muted" style="margin-top:8px;font-size:12px;"></div>
  <div id="result" class="box">üîé Keres√©shez √≠rd be a neved.</div>

  <script>
    // üîß √ÅLL√çTS EGY √öJ VERZI√ìT, ha m√≥dos√≠tasz (hogy l√°sd, mi √©l kint)
    const VERSION = "VERZI√ì: 2025-12-14 13:05";

    const $ = (id) => document.getElementById(id);

    // √©kezetmentes + kisbet≈±s √∂sszehasonl√≠t√°shoz
    function norm(s) {
      return (s || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")  // √©kezetek le
        .replace(/\s+/g, " ")
        .trim();
    }

    // Query tokenek (pl. "K√°d√°r Krisztina" -> ["kadar","krisztina"])
    function tokens(q) {
      return norm(q).split(" ").filter(Boolean);
    }

    // igaz, ha a sor tartalmazza az √∂sszes token-t
    function containsAll(hay, tok) {
      const h = norm(hay);
      return tok.every(t => h.includes(t));
    }

    // A-form√°tum c√≠msor felismer√©se (pl. "A VAR√ÅZSLATOS T√âRK√âP - 86 lej")
    function isATitleLine(line) {
      const s = (line || "").trim();
      if (!s) return false;
      if (/^"?N√âV:/i.test(s)) return false;
      if (/^[‚Ä¢\*]/.test(s)) return false;
      if (/^\d+\./.test(s)) return false;
      return /lej/i.test(s) && /[-‚Äì‚Äî]/.test(s);
    }

    // A-form√°tum n√©v sor (pl. "1. Kov√°cs Anabella")
    function parseAName(line) {
      const m = (line || "").trim().match(/^(\d+)\.\s*(.+)$/);
      return m ? m[2].trim() : null;
    }

    // B-form√°tum n√©v fej (pl. '"N√âV: K√°d√°r Krisztina' vagy 'N√âV: K√°d√°r Krisztina')
    function parseBHeader(line) {
      const s = (line || "").trim();
      const m = s.match(/^"??N√âV:\s*(.+?)\s*"?$/i);
      return m ? m[1].trim() : null;
    }

    async function loadText() {
      // cache-biztos: mindig friss URL (GitHub Pages n√©ha ragaszkodik a r√©gihez)
      const url = "rendeles.txt?v=" + Date.now();
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("Nem tudtam bet√∂lteni: " + res.status);
      return await res.text();
    }

    async function search() {
      const qRaw = $("name").value || "";
      const tok = tokens(qRaw);
      const result = $("result");

      if (!tok.length) {
        result.innerHTML = "üîé √çrj be egy nevet üôÇ";
        return;
      }

      result.innerHTML = "‚è≥ Keres√©s...";
      let text = "";

      try {
        text = await loadText();
      } catch (e) {
        result.innerHTML = "‚ùå Nem tudtam bet√∂lteni a <code>rendeles.txt</code> f√°jlt.";
        return;
      }

      const lines = text
        .split(/\r?\n/)
        .map(s => (s || "").trim());

      // Tal√°latok:
      // A: listac√≠mek, ahol a n√©v szerepel
      const foundA = new Set();

      // B: n√©v -> t√©telek (‚Ä¢ sorok)
      const foundB = new Map();

      // ====== A-form√°tum feldolgoz√°s (c√≠m + sz√°mozott nevek) ======
      let currentTitle = "";
      for (const line of lines) {
        if (!line) continue;

        if (isATitleLine(line)) {
          currentTitle = line;
          continue;
        }

        const nm = parseAName(line);
        if (nm && currentTitle) {
          if (containsAll(nm, tok)) {
            foundA.add(currentTitle);
          }
        }
      }

      // ====== B-form√°tum feldolgoz√°s ("N√âV:" + ‚Ä¢ t√©telek) ======
      let currentBName = null;
      let currentItems = [];

      function flushB() {
        if (currentBName && containsAll(currentBName, tok)) {
          const prev = foundB.get(currentBName) || [];
          // egyes√≠t (ne legyen dupl√°z√°s)
          const merged = [...prev];
          for (const it of currentItems) {
            if (!merged.includes(it)) merged.push(it);
          }
          foundB.set(currentBName, merged);
        }
      }

      for (const line of lines) {
        if (!line) continue;

        const bName = parseBHeader(line);
        if (bName) {
          // el≈ëz≈ë blokk ment√©se
          flushB();
          // √∫j blokk ind√≠t√°sa
          currentBName = bName;
          currentItems = [];
          continue;
        }

        // csak akkor gy≈±jt√ºnk t√©teleket, ha B blokkban vagyunk
        if (currentBName) {
          // t√©tel sor: ‚Ä¢ ...
          if (/^[‚Ä¢\]\s/.test(line)) {
            currentItems.push(line.replace(/^[‚Ä¢\]\s/, "‚Ä¢ ").trim());
            continue;
          }

          // ha √∫j A-c√≠m j√∂n, az biztosan v√©ge a B blokknak
          if (isATitleLine(line)) {
            flushB();
            currentBName = null;
            currentItems = [];
            continue;
          }
        }
      }
      // utols√≥ blokk ment√©se
      flushB();

      // ====== KI√çR√ÅS ======
      if (foundA.size === 0 && foundB.size === 0) {
        result.innerHTML = ‚ùå Nincs tal√°lat erre: <b>${qRaw}</b>;
        return;
      }

      let html = ‚úÖ <b>Tal√°latok:</b> <b>${qRaw}</b><br><br>;

      if (foundA.size) {
        html += <div class="secTitle">üìö List√°k (c√≠mek, ahol szerepelsz):</div><ul>;
        for (const t of [...foundA]) {
          html += <li>${t}</li>;
        }
        html += </ul>;
      }

      if (foundB.size) {
        html += <div class="secTitle">üßæ N√âV blokkok (t√©telek):</div>;
        for (const [name, items] of foundB.entries()) {
          html += <div style="margin:8px 0;"><b>${name}</b>;
          if (items.length) {
            html += <ul>;
            for (const it of items) html += <li>${it.replace(/^‚Ä¢\s*/, "")}</li>;
            html += </ul>;
          } else {
            html += <div class="muted">Nincs t√©tel sor (‚Ä¢)</div>;
          }
          html += </div>;
        }
      }

      result.innerHTML = html;
    }

    // ====== ESEM√âNYEK ======
    document.addEventListener("DOMContentLoaded", () => {
      $("ver").innerText = VERSION;

      $("btn").addEventListener("click", search);
      $("name").addEventListener("keydown", (e) => {
        if (e.key === "Enter") search();
      });
    });
  </script>
</body>
</html>
