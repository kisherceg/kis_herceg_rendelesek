<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg k√∂nyvesbolt ‚Äì rendel√©s keres≈ë</title>

  <style>
    :root{
      --card-bg: rgba(255,255,255,.82);
      --card-border: rgba(255,255,255,.35);
      --text: #1a1a1a;
      --muted: rgba(0,0,0,.62);
      --accent: #f2c14e;      /* arany csillag */
      --accent2: #2f5aa6;     /* m√©lyk√©k */
      --btn-bg: rgba(47,90,166,.92);
      --btn-bg2: rgba(47,90,166,.78);
      --btn-text: #ffffff;
      --shadow: 0 18px 50px rgba(0,0,0,.28);
    }

    * { box-sizing: border-box; }

    body{
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);

      /* h√°tt√©r */
      background-image: url("hatter.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    /* finom s√∂t√©t f√°tyol, hogy olvashat√≥ legyen */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      background: linear-gradient(
        180deg,
        rgba(6,12,28,.58),
        rgba(6,12,28,.30),
        rgba(6,12,28,.55)
      );
      pointer-events: none;
      z-index: 0;
    }

    .wrap{
      position: relative;
      z-index: 1;
      max-width: 720px;
      margin: 0 auto;
      padding: 26px 14px 40px;
    }

    .card{
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 18px 18px 16px;
      backdrop-filter: blur(6px);
    }

    .header{
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .logo{
      width: 54px;
      height: 54px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(255,255,255,.35);
      padding: 6px;
      border: 1px solid rgba(255,255,255,.25);
    }

    h1{
      margin: 0;
      font-size: 20px;
      line-height: 1.15;
      letter-spacing: .2px;
    }

    .subtitle{
      margin: 8px 0 14px;
      color: var(--muted);
      font-size: 14px;
    }

    .row{
      display: grid;
      gap: 10px;
      grid-template-columns: 1fr;
    }

    input{
      width: 100%;
      padding: 12px 14px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.18);
      outline: none;
      background: rgba(255,255,255,.90);
    }
    input:focus{
      border-color: rgba(47,90,166,.65);
      box-shadow: 0 0 0 3px rgba(47,90,166,.18);
    }

    button{
      width: 100%;
      padding: 12px 14px;
      font-size: 16px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      color: var(--btn-text);
      background: linear-gradient(180deg, var(--btn-bg), var(--btn-bg2));
      box-shadow: 0 10px 25px rgba(47,90,166,.25);
      transition: transform .06s ease, filter .15s ease;
    }
    button:hover{ filter: brightness(1.04); }
    button:active{ transform: translateY(1px); }

    .result{
      margin-top: 14px;
      padding: 14px;
      border-radius: 14px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.08);
    }

    .muted{ color: var(--muted); font-size: 13px; }

    .secTitle{
      margin: 14px 0 6px;
      font-weight: 800;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(242,193,78,.18);
      border: 1px solid rgba(242,193,78,.35);
    }

    ul{ margin: 8px 0 0 18px; }
    li{ margin: 4px 0; }

    .badge{
      display:inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.8);
      font-size: 12px;
      color: rgba(0,0,0,.70);
      margin-top: 10px;
    }

    .smallTop{
      margin-top: 10px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .footerNote{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(0,0,0,.55);
    }
  </style>
</head>
  
<body>
  <h2>üìö Kis Herceg k√∂nyvesbolt - k√∂nyvrendel√©s keres≈ë</h2>
  <p>√çrd be a neved, √©s megn√©zz√ºk az <b>aj√°nl√°s</b> √©s a <b>rendel√©s</b> list√°kat.</p>

  <input id="name" placeholder="Pl. K√°d√°r Krisztina" />
  <button id="btn" type="button">Keres√©s</button>

  <div id="ver" class="muted"></div>
  <div id="result" class="box">üîé Keres√©shez √≠rd be a neved.</div>

<script>
(() => {
  const VERSION = "VERZI√ì: 2025-12-14 (2 f√°jl: ajanlas.txt + rendelesek.txt)";
  const $ = (id) => document.getElementById(id);

  // √©kezet- √©s id√©z≈ëjel-toler√°ns keres√©s
  function norm(s) {
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")   // √©kezet le
      .replace(/[‚Äú‚Äù‚Äû"]/g, "")           // id√©z≈ëk le
      .replace(/\s+/g, " ");            // sok space -> 1
  }
  function tokens(q) {
    return norm(q).split(" ").filter(Boolean);
  }
  function containsAll(hay, tok) {
    const h = norm(hay);
    return tok.every(t => h.includes(t));
  }

  // ---------- AJ√ÅNL√ÅS: c√≠m + sorsz√°mos nevek ----------
  function isATitle(line) {
    // pl: "A VAR√ÅZSLATOS T√âRK√âP - 86 lej"
    const s = (line || "").trim();
    if (!s) return false;
    if (/^\d+\./.test(s)) return false;
    if (/^[‚Ä¢\*\-]/.test(s)) return false;
    return /lej/i.test(s) && /[-‚Äì‚Äî]/.test(s);
  }
  function parseANumberedName(line) {
    const m = (line || "").trim().match(/^\d+\.\s*(.+)$/);
    return m ? m[1].trim() : null;
  }

  // ---------- RENDEL√âSEK: N√âV: + ‚Ä¢ t√©telek ----------
  function parseBHeader(line) {
    // N√âV: Valaki (id√©z≈ëjellel is)
    const m = (line || "").trim().match(/^"??\s*N√âV\s*:\s*(.+?)\s*"?$/i);
    return m ? m[1].trim() : null;
  }
  function isBullet(line) {
    return /^[‚Ä¢\\-]\s/.test((line || "").trim());
  }
  function cleanBullet(line) {
    return (line || "").trim().replace(/^[‚Ä¢\\-]\s/, "").trim();
  }

  async function loadTxt(file) {
    // cache-biztos: mindig friss URL
    const url = file + "?v=" + Date.now();
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(file + " HTTP " + res.status);
    return await res.text();
  }

  function parseAjanlas(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);
    const foundTitles = new Set();
    let currentTitle = "";

    for (const line of lines) {
      if (isATitle(line)) { currentTitle = line; continue; }
      const nm = parseANumberedName(line);
      if (nm && currentTitle && containsAll(nm, tok)) foundTitles.add(currentTitle);
    }
    return [...foundTitles];
  }

  function parseRendelesek(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);

    const matches = []; // { name, items[] }
    let curName = null;
    let curItems = [];

    function flush() {
      if (!curName) return;
      if (containsAll(curName, tok)) {
        // dupl√°k ellen
        const uniq = [];
        for (const it of curItems) if (!uniq.includes(it)) uniq.push(it);
        matches.push({ name: curName, items: uniq });
      }
    }

    for (const line of lines) {
      const header = parseBHeader(line);
      if (header) {
        flush();
        curName = header;
        curItems = [];
        continue;
      }
      if (curName && isBullet(line)) {
        curItems.push(cleanBullet(line));
      }
    }
    flush();
    return matches;
  }

  async function search() {
    const qRaw = $("name").value || "";
    const tok = tokens(qRaw);
    const out = $("result");

    out.innerHTML = "‚è≥ Keres√©s‚Ä¶";

    if (!tok.length) {
      out.innerHTML = "üîé √çrj be egy nevet üôÇ";
      return;
    }

    let ajanlasTxt = "";
    let rendelesTxt = "";

    try {
      // p√°rhuzamos bet√∂lt√©s
      [ajanlasTxt, rendelesTxt] = await Promise.all([
        loadTxt("ajanlas.txt"),
        loadTxt("rendelesek.txt")
      ]);
    } catch (e) {
      out.innerHTML = "‚ùå Hiba a f√°jl bet√∂lt√©sn√©l: <code>" + (e && e.message ? e.message : e) + "</code><br>" +
                      "Ellen≈ërizd, hogy a repo gy√∂ker√©ben van: <b>ajanlas.txt</b> √©s <b>rendelesek.txt</b>.";
      return;
    }

    const foundA = parseAjanlas(ajanlasTxt, tok);
    const foundB = parseRendelesek(rendelesTxt, tok);

    if (!foundA.length && !foundB.length) {
      out.innerHTML = "‚ùå Nincs tal√°lat erre: <b>" + qRaw + "</b>";
      return;
    }

    let html = "‚úÖ <b>Tal√°lat:</b> <b>" + qRaw + "</b><br><br>";

    if (foundA.length) {
      html += '<div class="sec">üìö Aj√°nl√°s (c√≠mek, ahol szerepelsz):</div><ul>';
      foundA.forEach(t => html += "<li>" + t + "</li>");
      html += "</ul>";
    }

    if (foundB.length) {
      html += '<div class="sec">üßæ Rendel√©sek (N√âV: blokk):</div>';
      foundB.forEach(b => {
        html += "<b>" + b.name + "</b>";
        if (b.items.length) {
          html += "<ul>";
          b.items.forEach(it => html += "<li>" + it + "</li>");
          html += "</ul>";
        } else {
          html += '<div class="muted">Nincs ‚Ä¢ t√©tel sor ehhez a n√©vhez.</div>';
        }
      });
    }

    out.innerHTML = html;
  }

  document.addEventListener("DOMContentLoaded", () => {
    $("ver").innerText = VERSION;
    $("btn").addEventListener("click", search);
    $("name").addEventListener("keydown", (e) => { if (e.key === "Enter") search(); });
  });
})();
</script>
</body>
</html>
