<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kis Herceg â€“ RendelÃ©s keresÅ‘</title>
<style>
  body{font-family:Arial;max-width:640px;margin:auto;padding:18px}
  input{width:100%;padding:12px;font-size:16px;box-sizing:border-box}
  button{margin-top:10px;padding:12px;width:100%;font-size:16px;cursor:pointer}
  .box{margin-top:14px;padding:12px;border:1px solid #ddd;border-radius:10px}
</style>
</head>
<body>
<h2>ğŸ“š Kis Herceg â€“ NÃ©v szerinti keresÅ‘</h2>
<p>Ãrd be a neved, Ã©s kilistÃ¡zzuk a tÃ©teleidet.</p>

<input id="name" placeholder="Pl. BÃ­rÃ³ RÃ©ka">
<button onclick="search()">KeresÃ©s</button>

<div class="box" id="result">ğŸ” KeresÃ©shez Ã­rd be a neved.</div>
<script>
async function search() {
  const qRaw = document.getElementById("name").value.trim();
  const q = qRaw.toLowerCase();
  const result = document.getElementById("result");

  if (!q) { result.innerHTML = "Ãrj be egy nevet ğŸ˜Š"; return; }

  // 1) betÃ¶ltjÃ¼k a rendeles.txt-t
  let text = "";
  try {
    const res = await fetch("rendeles.txt", { cache: "no-store" });
    text = await res.text();
  } catch (e) {
    result.innerHTML = "Nem tudtam betÃ¶lteni a rendeles.txt fÃ¡jlt ğŸ˜•";
    return;
  }

  const lines = text.split(/\r?\n/).map(l => (l || "").trim());

  // talÃ¡latok
  const foundTitles = new Set();      // (1) ajÃ¡nlÃ³s listÃ¡k: cÃ­mek
  const foundByName = {};             // (2) tÃ¡blÃ¡zatos / NÃ‰V: blokkok

  // ---- SEGÃ‰DEK
  const isRecTitle = (s) => /lej/i.test(s) && /[-â€“â€”]/.test(s);          // "CÃM - 86 lej"
  const isRecName  = (s) => /^\d+\.\s+/.test(s);                        // "1. KovÃ¡cs..."
  const cleanRecName = (s) => s.replace(/^\d+\.\s+/, "").trim();

  const isNevLine = (s) => s.replace(/^"|"$/g,"").trim().toLowerCase().startsWith("nÃ©v:");
  const cleanNev = (s) => s.replace(/^"|"$/g,"").trim().replace(/^nÃ©v:\s*/i,"").trim();

  const isBullet = (s) => s.startsWith("â€¢") || s.startsWith("-") || s.startsWith("*");
  const cleanBullet = (s) => s.replace(/^["']|["']$/g,"").trim().replace(/^[â€¢\-]\s/,"").trim();

  // ---- (1) AJÃNLÃ“S LISTA FORMÃTUM: "CÃM - Ã¡r lej" + "1. NÃ©v"
  let currentTitle = "";
  for (const line of lines) {
    if (!line) continue;

    if (isRecTitle(line)) { currentTitle = line; continue; }

    if (currentTitle && isRecName(line)) {
      const nm = cleanRecName(line).toLowerCase();
      if (nm.includes(q)) foundTitles.add(currentTitle);
    }
  }

  // ---- (2) NÃ‰V: BLOKKOK: "NÃ‰V: Valaki" + bullet tÃ©telek
  let currentName = "";
  for (let i = 0; i < lines.length; i++) {
    const raw = lines[i];
    if (!raw) continue;

    if (isNevLine(raw)) {
      currentName = cleanNev(raw);
      continue;
    }

    if (currentName && isNevLine(raw)) { // biztos ami biztos
      currentName = cleanNev(raw);
      continue;
    }

    if (currentName && isBullet(raw)) {
      const item = cleanBullet(raw);
      if (currentName.toLowerCase().includes(q)) {
        if (!foundByName[currentName]) foundByName[currentName] = [];
        foundByName[currentName].push(item);
      }
    }
  }

  // ---- KIÃRÃS
  if (foundTitles.size === 0 && Object.keys(foundByName).length === 0) {
    result.innerHTML = "âŒ Nem talÃ¡ltunk talÃ¡latot ezzel a nÃ©vvel.";
    return;
  }

  let html = âœ… TalÃ¡lat: <b>${qRaw}</b><br><br>;

  if (foundTitles.size) {
    html += "<b>ğŸ“Œ AjÃ¡nlÃ³s listÃ¡k:</b><br>";
    [...foundTitles].forEach(t => html += "â€¢ " + t + "<br>");
    html += "<br>";
  }

  const names = Object.keys(foundByName);
  if (names.length) {
    html += "<b>ğŸ§¾ TÃ¡blÃ¡zatos / NÃ‰V: rendelÃ©sek:</b><br><br>";
    names.forEach(n => {
      html += <b>${n}</b><br>;
      foundByName[n].forEach(it => html += "â€¢ " + it + "<br>");
      html += "<br>";
    });
  }

  result.innerHTML = html;
}
</script>
</body>
</html>
