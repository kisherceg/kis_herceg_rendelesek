<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg - Rendel√©s keres≈ë</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 680px; margin: 0 auto; padding: 18px; }
    input { width: 100%; padding: 12px; font-size: 16px; box-sizing: border-box; }
    button { margin-top: 10px; padding: 12px; width: 100%; font-size: 16px; cursor: pointer; }
    .box { margin-top: 14px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color: #666; }
    h2 { margin: 0 0 8px 0; }
    h3 { margin: 14px 0 6px 0; }
    ul { margin: 6px 0 0 18px; }
    .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-left:8px; color:#444; }
    .err { color: #b00020; }
  </style>
</head>

<body>
  <h2>üìö Kis Herceg ‚Äì N√©v szerinti keres≈ë</h2>
  <p class="muted">√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

  <input id="name" placeholder="Pl. B√≠r√≥ R√©ka" />
  <button id="btn" type="button">Keres√©s</button>

  <div class="box" id="result">üîé Keres√©shez √≠rd be a neved.</div>

<script>
(function () {
  const $ = (id) => document.getElementById(id);

  // √©kezetf√ºggetlen, kisbet≈±s √∂sszehasonl√≠t√°s
  function norm(s) {
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, ""); // √©kezetek leszed√©se
  }

  function stripQuotes(s) {
    return (s || "").trim().replace(/^"+|"+$/g, "").trim();
  }

  function isTitleLine(line) {
    // Aj√°nl√≥s c√≠m: tartalmaz k√∂t≈ëjelet/gondolatjelet √©s "lej"-t
    const s = norm(line);
    return /lej/.test(s) && (s.includes(" - ") || s.includes(" ‚Äì ") || s.includes("-"));
  }

  function isNumberedName(line) {
    // pl: "1. Kov√°cs Anabella"
    return /^\s*\d+\.\s+/.test(line);
  }

  function isNameHeader(line) {
    // pl: N√âV: K√°d√°r Krisztina   vagy  "N√âV: K√°d√°r Krisztina"
    const t = stripQuotes(line);
    return /^\s*N√âV\s*:\s*/i.test(t);
  }

  function parseNameHeader(line) {
    const t = stripQuotes(line).replace(/^\s*N√âV\s*:\s*/i, "").trim();
    return t;
  }

  function isBulletItem(line) {
    // pl: ‚Ä¢ S√°rga ‚Äì 50 lej    (id√©z≈ëjelek lehetnek a sor v√©g√©n/elej√©n)
    const t = stripQuotes(line);
    return /^\s*[‚Ä¢\-\*]\s+/.test(t);
  }

  function cleanBulletItem(line) {
    return stripQuotes(line).replace(/^\s*[‚Ä¢\-\*]\s+/, "").trim();
  }

  // A r√©gi "Bak√≥ J√°nosi Annm√°ria ‚Äì Bookline rendel√©s DECEMBER 1." jelleg≈± blokk is legyen t√°mogatva:
  function looksLikePersonOrderTitle(line) {
    // tartalmazza: "Bookline rendel√©s" √©s van benne gondolatjel
    const t = stripQuotes(line);
    return /bookline\s+rendel[e√©]s/i.test(t) && (t.includes(" ‚Äì ") || t.includes(" - "));
  }

  // ----------- F≈ê KERES≈ê -----------
  async function search() {
    const raw = $("name").value.trim();
    const q = norm(raw);
    const result = $("result");

    if (!q) {
      result.innerHTML = "√çrj be egy nevet üôÇ";
      return;
    }

    // 1) txt bet√∂lt√©s
    let text = "";
    try {
      const res = await fetch("rendeles.txt?v=" + Date.now(), { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      text = await res.text();
    } catch (e) {
      result.innerHTML = `<span class="err">Nem tudtam bet√∂lteni a rendeles.txt f√°jlt.</span><br>
      Ellen≈ërizd, hogy a repo gy√∂ker√©ben van-e: <b>rendeles.txt</b> (ugyanott, ahol az index.html).`;
      return;
    }

    const lines = text
      .split(/\r?\n/)
      .map(l => (l || "").trim())
      .filter(l => l.length);

    // TAL√ÅLATOK
    const foundRecommendations = new Set(); // aj√°nl√≥s c√≠mek, ahol szerepel a n√©v
    const foundOrders = new Map(); // n√©v -> t√©telek (rendel√©s)

    // -------- 1) AJ√ÅNL√ìS LISTA (c√≠m + 1. N√©v sorok) --------
    let currentTitle = "";
    for (const line0 of lines) {
      const line = stripQuotes(line0);

      if (isTitleLine(line)) {
        currentTitle = line;
        continue;
      }

      if (currentTitle && isNumberedName(line)) {
        const namePart = line.replace(/^\s*\d+\.\s+/, "").trim();
        if (norm(namePart).includes(q)) foundRecommendations.add(currentTitle);
      }
    }

    // -------- 2) RENDEL√âS LISTA (N√âV: ... + ‚Ä¢ t√©telek) --------
    // plusz: r√©gi Bookline rendel√©s blokk (n√©v - Bookline rendel√©s...) + ‚Ä¢ t√©telek
    let currentPerson = "";
    for (let i = 0; i < lines.length; i++) {
      const rawLine = lines[i];
      const line = stripQuotes(rawLine);

      // N√âV: fejl√©c
      if (isNameHeader(line)) {
        currentPerson = parseNameHeader(line);
        continue;
      }

      // Bookline rendel√©s fejl√©c (r√©gi blokk)
      if (looksLikePersonOrderTitle(line)) {
        // n√©v a gondolatjel el≈ëtt
        const parts = line.split("‚Äì").length > 1 ? line.split("‚Äì") : line.split("-");
        currentPerson = (parts[0] || "").trim();
        continue;
      }

      // bullet t√©tel
      if (currentPerson && isBulletItem(line)) {
        if (norm(currentPerson).includes(q)) {
          const item = cleanBulletItem(line);
          if (!foundOrders.has(currentPerson)) foundOrders.set(currentPerson, []);
          // dupl√°k ellen
          const arr = foundOrders.get(currentPerson);
          if (!arr.includes(item)) arr.push(item);
        }
      }
    }

    // -------- EREDM√âNY KI√çR√ÅSA --------
    if (foundRecommendations.size === 0 && foundOrders.size === 0) {
      result.innerHTML = ‚ùå Nem tal√°ltunk tal√°latot ezzel a n√©vvel: <b>${raw}</b>;
      return;
    }

    let html = ‚úÖ Tal√°lat: <b>${raw}</b><br><br>;

    if (foundRecommendations.size) {
      html += <b>üìå Aj√°nl√≥s list√°k:</b><br>;
      [...foundRecommendations].forEach(t => {
        html += ‚Ä¢ ${t}<br>;
      });
      html += <br>;
    }

    if (foundOrders.size) {
      html += <b>üõí Rendel√©sek (N√âV: ... / Bookline blokk):</b><br>;
      for (const [person, items] of foundOrders.entries()) {
        html += <div style="margin-top:10px;"><b>${person}</b> <span class="pill">${items.length} t√©tel</span><br>;
        if (items.length) {
          html += <ul>;
          items.forEach(it => html += <li>${it}</li>);
          html += </ul>;
        } else {
          html += <span class="muted">Nincs t√©tel sor (‚Ä¢)</span>;
        }
        html += </div>;
      }
    }

    result.innerHTML = html;
  }

  // gomb + Enter
  document.addEventListener("DOMContentLoaded", () => {
    $("btn").addEventListener("click", search);
    $("name").addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  });

  // ha a script a body v√©g√©n van, DOMContentLoaded m√°r lehet lefutott,
  // ez√©rt biztosra megy√ºnk:
  if (document.readyState !== "loading") {
    $("btn").addEventListener("click", search);
    $("name").addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  }

})();
</script>
</body>
</html>
