<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kis Herceg ‚Äì Rendel√©s keres≈ë</title>
<style>
  body{font-family:Arial;max-width:640px;margin:auto;padding:18px}
  input{width:100%;padding:12px;font-size:16px;box-sizing:border-box}
  button{margin-top:10px;padding:12px;width:100%;font-size:16px;cursor:pointer}
  .box{margin-top:14px;padding:12px;border:1px solid #ddd;border-radius:10px}
</style>
</head>
<body>
<h2>üìö Kis Herceg ‚Äì N√©v szerinti keres≈ë</h2>
<p>√çrd be a neved, √©s kilist√°zzuk a t√©teleidet.</p>

<input id="name" placeholder="Pl. B√≠r√≥ R√©ka">
<button onclick="search()">Keres√©s</button>

<div class="box" id="result">üîé Keres√©shez √≠rd be a neved.</div>

<script>
async function search() {
  const qRaw = document.getElementById("name").value.trim();
  const q = qRaw.toLowerCase();
  const result = document.getElementById("result");
  if (!q) { result.innerHTML = "√çrj be egy nevet üôÇ"; return; }

  const res = await fetch("rendeles.txt", { cache: "no-store" });
  const text = await res.text();
  const lines = text.split(/\r?\n/).map(l => (l || "").trim());

  const foundA = new Set();              // 1) Aj√°nl√≥s lista: c√≠mek
  const foundB = {};                     // 2) Bookline t√°bl√°zat: {orderTitle: [t√©telek...]}

  const hasDash = (s) => /[-‚Äì‚Äî]/.test(s);
  const isAllCapsTitle = (s) => s && s === s.toUpperCase() && s.length > 6;
  const isHeaderLine = (s) => /^(N√âV|K√ñNYV|√ÅR)$/i.test(s.replace(/\s+/g, ""));

  // Seg√©d: rendel√©s c√≠m√©nek felismer√©se (pl. "Bookline rendel√©s DECEMBER 1.")
  const isOrderTitle = (s) => /rendel[e√©]s/i.test(s);

  // =========================
  // 1) AJ√ÅNL√ìS LISTA FORM√ÅTUM
  // =========================
  let currentTitle = "";
  for (const line of lines) {
    if (!line) continue;

    // C√≠msor: van benne "lej" √©s valamilyen k√∂t≈ëjel/gondolatjel
    if (hasDash(line) && /lej/i.test(line)) {
      currentTitle = line;
      continue;
    }

    // N√©v sor: "1. N√©v" ‚Üí "N√©v"
    const namePart = line.replace(/^\d+\.\s*/, "").trim();
    if (currentTitle && namePart.toLowerCase().includes(q)) {
      foundA.add(currentTitle);
    }
  }

  // =========================
  // 2) BOOKLINE / T√ÅBL√ÅZATOS FORM√ÅTUM
  // =========================
  let orderTitle = "Bookline / t√°bl√°zatos rendel√©s";
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i];
    if (!line) continue;

    // Rendel√©s c√≠me (kontektsz√∂veg)
    if (isOrderTitle(line)) orderTitle = line;

    // Ha a sor tartalmazza a nevet, itt indulhat egy blokk
    if (line.toLowerCase().includes(q)) {
      // A n√©v sor ut√°n v√°rhat√≥an j√∂nnek a t√©telek sorokban.
      let items = [];
      for (let j = i + 1; j < lines.length; j++) {
        const next = lines[j];

        // meg√°ll√≥k: √ºres sor / √∫j nagy c√≠msor / fejl√©c / √∫j n√©v (nagyon val√≥sz√≠n≈±)
        if (!next) break;
        if (isOrderTitle(next)) break;
        if (isHeaderLine(next)) continue;
        if (isAllCapsTitle(next)) break;

        // Heurisztika √∫j n√©vre: r√∂vid, 2-4 szavas, nincs "lej", nincs sz√°m a v√©g√©n
        const looksLikeNewName =
          next.split(/\s+/).length >= 2 &&
          next.split(/\s+/).length <= 4 &&
          !/lej/i.test(next) &&
          !/\d+$/.test(next) &&
          /^[A-Z√Å√â√ç√ì√ñ≈ê√ö√ú≈∞]/.test(next);

        if (looksLikeNewName) break;

        items.push(next);
      }

      if (items.length) {
        if (!foundB[orderTitle]) foundB[orderTitle] = [];
        // duplik√°tumok ellen:
        items.forEach(it => {
          if (!foundB[orderTitle].includes(it)) foundB[orderTitle].push(it);
        });
      }
    }
  }

  // =========================
  // EREDM√âNY KI√çR√ÅSA
  // =========================
  if (foundA.size === 0 && Object.keys(foundB).length === 0) {
    result.innerHTML = "‚ùå Nem tal√°ltunk tal√°latot ezzel a n√©vvel.";
    return;
  }

  let html = ‚úÖ Tal√°lat: <b>${qRaw}</b><br><br>;

  if (foundA.size) {
    html += "<b>üìå Aj√°nl√≥s list√°k:</b><br>";
    [...foundA].forEach(t => { html += "‚Ä¢ " + t + "<br>"; });
    html += "<br>";
  }

  const orders = Object.keys(foundB);
  if (orders.length) {
    html += "<b>üì¶ Bookline / t√°bl√°zatos rendel√©sek:</b><br><br>";
    orders.forEach(o => {
      html += <b>${o}</b><br>;
      foundB[o].forEach(it => { html += "‚Ä¢ " + it + "<br>"; });
      html += "<br>";
    });
  }

  result.innerHTML = html;
}
</script>
</body>
</html>
