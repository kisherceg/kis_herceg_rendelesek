<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kis Herceg – Kereső</title>
  <style>
  :root{
  --blue1: rgba(10, 32, 70, .78);
  --blue2: rgba(22, 56, 110, .72);
  --card: rgba(255,255,255,.86);
  --card2: rgba(255,255,255,.92);
  --text: #0b1530;
  --muted: rgba(11,21,48,.72);
  --line: rgba(11,21,48,.18);
  --btn: #234b8e;
  --btn2:#1a3c74;
  --gold:#f6c45b;
}

*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  color: var(--text);

  background-image: url("hatter.JPG");
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  min-height: 100vh;
  display:flex;
  justify-content:center;
  padding: 28px 14px;
}

.wrap{
  width: min(720px, 100%);
  background: linear-gradient(180deg, var(--blue1), var(--blue2));
  border: 1px solid rgba(255,255,255,.22);
  border-radius: 18px;
  box-shadow: 0 18px 50px rgba(0,0,0,.25);
  overflow:hidden;
}

.header{
  display:flex;
  flex-direction: column;
  align-items:center;
  text-align:center;
  gap: 10px;
  padding: 26px 18px 10px;
}

.logo{
  width: 150px;
  height: 150px;
  background: none;
  padding: 0;
  border: none;
}

.logo img{
  width:100%;
  height:100%;
  object-fit: contain;
  display:block;
  border-radius: 8px;
}

h2, h3{
  margin:0;
  line-height: 1.15;
}

h2{ font-size: 48px; font-weight: 900; letter-spacing: 1px; }
h3{ font-size: 22px; font-weight: 700; color: rgba(255,255,255,.92); }

.gold{ color:#f6c45b; }

.title{
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.quote{
  margin: 6px 0 10px;
  padding: 0 18px 14px;
  color: rgba(255,255,255,.92);
  font-size: 18px;
  text-align:center;
  text-shadow: 0 2px 10px rgba(0,0,0,.25);
}

/* ====== EZ A RÉSZ A FONTOS: panel + input + button ====== */

.panel{
  background: rgba(255,255,255,.88);
  margin: 0 auto 24px;          /* középre */
  max-width: 420px;             /* laptopon is “telefonos” arány */
  width: calc(100% - 36px);
  border-radius: 18px;
  padding: 18px;
  box-shadow: 0 18px 40px rgba(0,0,0,.20);
}

.panel input{
  width: 100%;
  display: block;
  padding: 16px 16px;
  font-size: 18px;
  border-radius: 14px;
  border: 1px solid var(--line);
  outline: none;
  background: var(--card2);
}

.panel input:focus{
  border-color: rgba(35,75,142,.55);
  box-shadow: 0 0 0 4px rgba(35,75,142,.16);
}

.panel button{
  width: 100%;
  display: block;
  margin-top: 12px;
  padding: 16px 16px;
  font-size: 20px;
  font-weight: 800;
  border: none;
  border-radius: 14px;
  color: #fff;
  cursor: pointer;

  background: linear-gradient(180deg, var(--btn), var(--btn2));
  box-shadow: 0 10px 24px rgba(26,60,116,.28);
  transition: transform .08s ease, filter .2s ease, box-shadow .2s ease;
}

.panel button:hover{ filter: brightness(1.06); }
.panel button:active{ transform: translateY(1px); }

/* találat blokk */
.box{
  margin-top: 14px;
  padding: 14px;
  border-radius: 14px;
  border: 1px solid rgba(11,21,48,.12);
  background: rgba(255,255,255,.92);
}

.box .sec{
  font-weight: 800;
  margin: 0 0 8px;
  display:flex;
  align-items:center;
  gap:8px;
}

.box .sec::before{ content:"✨"; }

ul{
  margin: 8px 0 0 0;
  padding-left: 18px;
}
li{ margin: 6px 0; }

.muted{
  color: var(--muted);
  font-size: 13px;
  margin-top: 10px;
}

/* mobil */
@media (max-width: 520px){
  body{ padding: 16px 10px; }
  h2{ font-size: 30px; }
  h3{ font-size: 16px; }
  .logo{ width: 120px; height: 120px; }
  .header{ padding: 16px 14px 8px; }
  .panel{
    max-width: 420px;
    width: calc(100% - 24px);
    margin: 0 auto 14px;
    padding: 16px;
  }
}
</style>
</head>
  
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">
          <img src="logo.png" alt="Kis Herceg">
       </div>
       <div class="title">
          <h2> <span class="gold"> KIS HERCEG KÖNYVESBOLT </span> </h2>
          <h3> könyvrendelés kereső</h3>
      </div>
    </div>
    
   <div class="quote">⭐ Talán vár rád itt egy csomag…</div>

    <div class="panel">
        <input id="name" placeholder="Pl. Kis Herceg" />
        <button id="btn" type="button">Keresés</button>
        <div id="ver" class="muted"></div>
        <div id="result" class="box" style="display:none"></div>
    </div>
  </div>

<script>
(() => {
    const VERSION = "";
    const $ = (id) => document.getElementById(id);

  // ékezet- és idézőjel-toleráns keresés
  function norm(s) {
    return (s || "")
      .toString()
      .trim()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")   // ékezet le
      .replace(/[“”„"]/g, "")           // idézők le
      .replace(/\s+/g, " ");            // sok space -> 1
  }
  function tokens(q) {
    return norm(q).split(" ").filter(Boolean);
  }
  function containsAll(hay, tok) {
    const h = norm(hay);
    return tok.every(t => h.includes(t));
  }

  // ---------- AJÁNLÁS: cím + sorszámos nevek ----------
  function isATitle(line) {
    // pl: "A VARÁZSLATOS TÉRKÉP - 86 lej"
    const s = (line || "").trim();
    if (!s) return false;
    if (/^\d+\./.test(s)) return false;
    if (/^[•\*\-]/.test(s)) return false;
    return /lej/i.test(s) && /[-–—]/.test(s);
  }
  function parseANumberedName(line) {
    const m = (line || "").trim().match(/^\d+\.\s*(.+)$/);
    return m ? m[1].trim() : null;
  }

  // ---------- RENDELÉSEK: NÉV: + • tételek ----------
  function parseBHeader(line) {
    // NÉV: Valaki (idézőjellel is)
    const m = (line || "").trim().match(/^"??\s*NÉV\s*:\s*(.+?)\s*"?$/i);
    return m ? m[1].trim() : null;
  }
  function isBullet(line) {
    return /^[•\-]\s/.test((line || "").trim());
  }
  function cleanBullet(line) {
    return (line || "").trim().replace(/^[•\-]\s/, "").trim();
  }

  async function loadTxt(file) {
    // cache-biztos: mindig friss URL
    const url = file + "?v=" + Date.now();
    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error(file + " HTTP " + res.status);
    return await res.text();
  }

  function parseAjanlas(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);
    const foundTitles = new Set();
    let currentTitle = "";

    for (const line of lines) {
      if (isATitle(line)) { currentTitle = line; continue; }
      const nm = parseANumberedName(line);
      if (nm && currentTitle && containsAll(nm, tok)) foundTitles.add(currentTitle);
    }
    return [...foundTitles];
  }

  function parseRendelesek(text, tok) {
    const lines = text.split(/\r?\n/).map(l => (l || "").trim()).filter(Boolean);

    const matches = []; // { name, items[] }
    let curName = null;
    let curItems = [];

    function flush() {
      if (!curName) return;
      if (containsAll(curName, tok)) {
        // duplák ellen
        const uniq = [];
        for (const it of curItems) if (!uniq.includes(it)) uniq.push(it);
        matches.push({ name: curName, items: uniq });
      }
    }

    for (const line of lines) {
      const header = parseBHeader(line);
      if (header) {
        flush();
        curName = header;
        curItems = [];
        continue;
      }
      if (curName && isBullet(line)) {
        curItems.push(cleanBullet(line));
      }
    }
    flush();
    return matches;
  }

  async function search() {
    const qRaw = $("name").value || "";
    const tok = tokens(qRaw);
    const out = $("result");
    out.style.display = "block";
    
    out.innerHTML = "⏳ Keresés…";

    if (!tok.length) {
    out.style.display = "none";
    return;
  }

    let ajanlasTxt = "";
    let rendelesTxt = "";

    try {
      // párhuzamos betöltés
      [ajanlasTxt, rendelesTxt] = await Promise.all([
        loadTxt("ajanlas.txt"),
        loadTxt("rendelesek.txt")
      ]);
    } catch (e) {
      out.innerHTML = "❌ Hiba a fájl betöltésnél: <code>" + (e && e.message ? e.message : e) + "</code><br>" +
                      "Ellenőrizd, hogy a repo gyökerében van: <b>ajanlas.txt</b> és <b>rendelesek.txt</b>.";
      return;
    }

    const foundA = parseAjanlas(ajanlasTxt, tok);
    const foundB = parseRendelesek(rendelesTxt, tok);

    if (!foundA.length && !foundB.length) {
      out.innerHTML = "❌ Nincs találat a te neved alapján! <b>" + qRaw + "</b>";
      return;
    }

    let html = "<b>Találtunk könyvet a te neved alatt:</b> <b>" + qRaw + "</b><br><br>";

    if (foundA.length) {
      html += '<div class="sec">Az általunk ajánlott könyvek közül:</div><ul>';
      foundA.forEach(t => html += "<li>" + t + "</li>");
      html += "</ul>";
    }

    if (foundB.length) {
      html += '<div class="sec">Az általad kért könyvek közül:</div>';
      foundB.forEach(b => {
        html += "<b>" + b.name + "</b>";
        if (b.items.length) {
          html += "<ul>";
          b.items.forEach(it => html += "<li>" + it + "</li>");
          html += "</ul>";
        } else {
          html += '<div class="muted">Nincs • tétel sor ehhez a névhez.</div>';
        }
      });
    }

    out.innerHTML = html;
  }

  document.addEventListener("DOMContentLoaded", () => {
    $("btn").addEventListener("click", search);
    $("name").addEventListener("keydown", (e) => { if (e.key === "Enter") search(); });
  });
})();
</script>
</body>
</html>
